{% extends "layout.html" %}
{% block content %}
<h3>Search for: "{{ query }}"</h3>
{% if songs|length > 0 %}
{{ pagination.info }}
{{ pagination.links }}
<table class="table table-striped">
  <thead>
    <tr>
      <th>Title</th>
      <th>Artist</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for song in songs %}
      <tr>
        <td>{{ song.title }}</td>
        <td>{{ song.artist }}</td>
        <td><a class="btn btn-default btn-sm" href="{{ url_for('song_info', song_id=song.id) }}"><span class="glyphicon glyphicon-info-sign"></span></a></td>
        <td>
          <div class="btn-group">
            <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="glyphicon glyphicon-plus-sign"></span>
            </button>
            <ul class="dropdown-menu">
              {% for playlist in playlists %}
                <li><a onclick="addSongToPlaylist({{song.id}}, {{playlist.id}}, '{{song.title}}', '{{playlist.title}}', this)">{{playlist.title}}</a></li>
              {% endfor %}
            </ul>
          </div>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
<script>
function addSongToPlaylist(songId, playlistId, songTitle, playlistTitle, elem) {
  if($(elem).hasClass('added'))
    return;
  $.ajax({
    type: "POST",
    url: "{{ url_for('playlist_song_add') }}",
    data: JSON.stringify({
      song_id: songId,
      playlist_id: playlistId
    }),
    contentType: "application/json",
    dataType: 'json',
    success: function() {
      flashSuccess('Added "' + songTitle + '" to "' + playlistTitle + '".')
      $(elem).html($(elem).text() + " <span class='glyphicon glyphicon-ok'></span>");
      $(elem).addClass('added');
    }
  });
}

function flashSuccess(message) {
  console.log('appending');
  $('#flashed_messages').append(
        '<div class="alert alert-success">' +
            '<button type="button" class="close" data-dismiss="alert">' +
            '&times;</button>' + message + '</div>');
}
</script>
{{ pagination.links }}
{% else %}
<p>No results found...</p>
{% endif %}
{% endblock %}
